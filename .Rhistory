win_loss,
OT,
OT_num,
pass,
rush,
rec,
points_allowed,
points_scored,
point_differential,
home_game)
schedule <- padding_weeks(schedule,
year[i])
if(exists("all_schedule")){
all_schedule <- rbind(all_schedule,
schedule)
rm(schedule)
} else {
all_schedule <- schedule
rm(schedule)
}
print(paste("Done with", teams$Team[j]))
}
}
all_schedule <- all_schedule %>%
mutate(season = year[i]) %>%
merge(bin) %>%
select(-`REM SOS`)
if(exists("all_schedule_all_year")){
all_schedule_all_year <- rbind(all_schedule_all_year,
all_schedule)
rm(all_schedule)
} else {
all_schedule_all_year <- all_schedule
rm(all_schedule)
}
print(paste0("Done with", year[i]))
}
library(rvest)
library(tidyverse)
library(rio)
source("Bye week function.R")
year <- c("2024",
"2023",
"2022",
"2021",
"2020")
teams <- import("2025 Teams.csv")
for(i in 1:length(year)){
html <- read_html(paste0("https://www.espn.com/college-football/fpi/_/view/resume/season/",
year[i]))
bin <- tryCatch({ html %>%
# html_element("tbody") %>%
html_table()
},  error=function(cond) {
})
bin <- do.call(cbind, bin)
colnames(bin) <- bin[1,]
rankings <- bin[-1,]
for(j in 1:nrow(teams)){
html <- read_html(paste0("https://www.espn.com/college-football/team/schedule/_/id/",
teams$code[j],
"/season/",
year[i]) )
schedule <- tryCatch({ html %>%
html_element("tbody") %>%
html_table()  %>%
as.data.frame()
},  error=function(cond) {
})
if(!(is.null(schedule))){
colnames(schedule) <-  schedule[schedule[,1] == "DATE",][1,]
schedule <-  schedule[!schedule[,1] == "DATE",]
schedule <- schedule[,-ncol(schedule)]
schedule <- schedule %>%
as.data.frame() %>%
filter(grepl("Fri", DATE) |
grepl("Sat", DATE) |
grepl(",", DATE)) %>%
filter(RESULT != "Canceled") %>%
filter(grepl("[0-9]",RESULT)) %>%
mutate(OT = grepl("OT", RESULT),
OT_num = str_extract_all(RESULT, ".(?=OT)"),
OT_num = ifelse(OT & OT_num == "", 1, OT_num),
OT_num = ifelse(OT, OT_num, NA)) %>%
mutate(RESULT = gsub(".(?=OT)", "", RESULT, perl = TRUE)) %>%
mutate(RESULT = ifelse(substr(RESULT,1,1) == "W" | substr(RESULT,1,1) == "L", RESULT, "NA-NA")) %>%
mutate(win_loss = substr(RESULT,1,1),
points_winner = map_chr(str_split(RESULT, "-"), 1),
points_winner = gsub("W", "", points_winner),
points_winner = gsub("L", "", points_winner),
points_loser = map_chr(str_split(RESULT, "-"),2),
points_loser = gsub("[^0-9]", "", points_loser),
points_loser = gsub("L", "", points_loser),
pass = gsub("[^0-9]", "", `HI PASS`),
rush = gsub("[^0-9]", "", `HI RUSH`),
rec = gsub("[^0-9]", "", `HI REC`),
points_allowed = ifelse(win_loss == "W", points_loser, points_winner),
points_scored = ifelse(win_loss == "W", points_winner, points_loser),
point_differential = as.numeric(points_scored) - as.numeric(points_allowed),
home_game = grepl("vs", OPPONENT),
OPPONENT = gsub("vs", "", OPPONENT),
OPPONENT = gsub("@", "", OPPONENT),
OPPONENT = gsub("\\*$", "", OPPONENT),
OPPONENT = gsub("[0-9]", "", OPPONENT),
OPPONENT = trimws(OPPONENT),
Team = trimws(teams$team_and_mascot[j]),
Team_id = teams$code[j]) %>%
select(date = "DATE",
Team,
Team_id,
opponent = "OPPONENT",
win_loss,
OT,
OT_num,
pass,
rush,
rec,
points_allowed,
points_scored,
point_differential,
home_game)
schedule <- padding_weeks(schedule,
year[i])
if(exists("all_schedule")){
all_schedule <- rbind(all_schedule,
schedule)
rm(schedule)
} else {
all_schedule <- schedule
rm(schedule)
}
print(paste("Done with", teams$Team[j]))
}
}
all_schedule <- all_schedule %>%
mutate(season = year[i]) %>%
merge(bin) %>%
select(-`REM SOS`)
if(exists("all_schedule_all_year")){
all_schedule_all_year <- rbind(all_schedule_all_year,
all_schedule)
rm(all_schedule)
} else {
all_schedule_all_year <- all_schedule
rm(all_schedule)
}
print(paste0("Done with", year[i]))
}
View(all_schedule_all_year)
write.csv(all_schedule_all_year, "CollegeFootballRankings24to20.csv", row.names = FALSE)
View(all_schedule_all_year)
class(all_schedule_all_year)
sapply(all_schedule_all_year, class)
all_schedule_all_year$OT_num
sapply(apply(all_schedule_all_year,2,as.character), class)
data <- all_schedule_all_year
data$OT_num <- ifelse(all(is.na(data$OT_num)), NA, data$OT_num)
class(data$OT_num)
library(rvest)
library(tidyverse)
library(rio)
source("Bye week function.R")
year <- c("2024",
"2023",
"2022",
"2021",
"2020")
teams <- import("2025 Teams.csv")
i <- 1
j <- 1
html <- read_html(paste0("https://www.espn.com/college-football/fpi/_/view/resume/season/",
year[i]))
bin <- tryCatch({ html %>%
# html_element("tbody") %>%
html_table()
},  error=function(cond) {
})
bin <- do.call(cbind, bin)
colnames(bin) <- bin[1,]
rankings <- bin[-1,]
for(j in 1:nrow(teams)){
html <- read_html(paste0("https://www.espn.com/college-football/team/schedule/_/id/",
teams$code[j],
"/season/",
year[i]) )
schedule <- tryCatch({ html %>%
html_element("tbody") %>%
html_table()  %>%
as.data.frame()
},  error=function(cond) {
})
if(!(is.null(schedule))){
colnames(schedule) <-  schedule[schedule[,1] == "DATE",][1,]
schedule <-  schedule[!schedule[,1] == "DATE",]
schedule <- schedule[,-ncol(schedule)]
schedule <- schedule %>%
as.data.frame() %>%
filter(grepl("Fri", DATE) |
grepl("Sat", DATE) |
grepl(",", DATE)) %>%
filter(RESULT != "Canceled") %>%
filter(grepl("[0-9]",RESULT)) %>%
mutate(OT = grepl("OT", RESULT),
OT_num = ifelse(OT, str_extract_all(RESULT, ".(?=OT)"), NA),
OT_num = ifelse(OT & OT_num == "", 1, OT_num)) %>%
mutate(RESULT = gsub(".(?=OT)", "", RESULT, perl = TRUE)) %>%
mutate(RESULT = ifelse(substr(RESULT,1,1) == "W" | substr(RESULT,1,1) == "L", RESULT, "NA-NA")) %>%
mutate(win_loss = substr(RESULT,1,1),
points_winner = map_chr(str_split(RESULT, "-"), 1),
points_winner = gsub("W", "", points_winner),
points_winner = gsub("L", "", points_winner),
points_loser = map_chr(str_split(RESULT, "-"),2),
points_loser = gsub("[^0-9]", "", points_loser),
points_loser = gsub("L", "", points_loser),
pass = gsub("[^0-9]", "", `HI PASS`),
rush = gsub("[^0-9]", "", `HI RUSH`),
rec = gsub("[^0-9]", "", `HI REC`),
points_allowed = ifelse(win_loss == "W", points_loser, points_winner),
points_scored = ifelse(win_loss == "W", points_winner, points_loser),
point_differential = as.numeric(points_scored) - as.numeric(points_allowed),
home_game = grepl("vs", OPPONENT),
OPPONENT = gsub("vs", "", OPPONENT),
OPPONENT = gsub("@", "", OPPONENT),
OPPONENT = gsub("\\*$", "", OPPONENT),
OPPONENT = gsub("[0-9]", "", OPPONENT),
OPPONENT = trimws(OPPONENT),
Team = trimws(teams$team_and_mascot[j]),
Team_id = teams$code[j]) %>%
select(date = "DATE",
Team,
Team_id,
opponent = "OPPONENT",
win_loss,
OT,
OT_num,
pass,
rush,
rec,
points_allowed,
points_scored,
point_differential,
home_game)
schedule <- padding_weeks(schedule,
year[i])
if(exists("all_schedule")){
all_schedule <- rbind(all_schedule,
schedule)
rm(schedule)
} else {
all_schedule <- schedule
rm(schedule)
}
print(paste("Done with", teams$Team[j]))
}
}
sapply(all_schedule, class)
View(all_schedule)
str_extract_all(teams$code, ".(?=OT)")
schedule <- tryCatch({ html %>%
html_element("tbody") %>%
html_table()  %>%
as.data.frame()
},  error=function(cond) {
})
colnames(schedule) <-  schedule[schedule[,1] == "DATE",][1,]
schedule <-  schedule[!schedule[,1] == "DATE",]
schedule <- schedule[,-ncol(schedule)]
str_extract_all(schedule$RESULT, ".(?=OT)")
if(!(is.null(schedule))){
colnames(schedule) <-  schedule[schedule[,1] == "DATE",][1,]
schedule <-  schedule[!schedule[,1] == "DATE",]
schedule <- schedule[,-ncol(schedule)]
schedule <- schedule %>%
as.data.frame() %>%
filter(grepl("Fri", DATE) |
grepl("Sat", DATE) |
grepl(",", DATE)) %>%
filter(RESULT != "Canceled") %>%
filter(grepl("[0-9]",RESULT)) %>%
mutate(OT = grepl("OT", RESULT),
OT_num = map_chr(ifelse(OT, str_extract_all(RESULT, ".(?=OT)"), NA), 1),
OT_num = ifelse(OT & OT_num == "", 1, OT_num)) %>%
mutate(RESULT = gsub(".(?=OT)", "", RESULT, perl = TRUE)) %>%
mutate(RESULT = ifelse(substr(RESULT,1,1) == "W" | substr(RESULT,1,1) == "L", RESULT, "NA-NA")) %>%
mutate(win_loss = substr(RESULT,1,1),
points_winner = map_chr(str_split(RESULT, "-"), 1),
points_winner = gsub("W", "", points_winner),
points_winner = gsub("L", "", points_winner),
points_loser = map_chr(str_split(RESULT, "-"),2),
points_loser = gsub("[^0-9]", "", points_loser),
points_loser = gsub("L", "", points_loser),
pass = gsub("[^0-9]", "", `HI PASS`),
rush = gsub("[^0-9]", "", `HI RUSH`),
rec = gsub("[^0-9]", "", `HI REC`),
points_allowed = ifelse(win_loss == "W", points_loser, points_winner),
points_scored = ifelse(win_loss == "W", points_winner, points_loser),
point_differential = as.numeric(points_scored) - as.numeric(points_allowed),
home_game = grepl("vs", OPPONENT),
OPPONENT = gsub("vs", "", OPPONENT),
OPPONENT = gsub("@", "", OPPONENT),
OPPONENT = gsub("\\*$", "", OPPONENT),
OPPONENT = gsub("[0-9]", "", OPPONENT),
OPPONENT = trimws(OPPONENT),
Team = trimws(teams$team_and_mascot[j]),
Team_id = teams$code[j]) %>%
select(date = "DATE",
Team,
Team_id,
opponent = "OPPONENT",
win_loss,
OT,
OT_num,
pass,
rush,
rec,
points_allowed,
points_scored,
point_differential,
home_game)
schedule <- padding_weeks(schedule,
year[i])
if(exists("all_schedule")){
all_schedule <- rbind(all_schedule,
schedule)
rm(schedule)
} else {
all_schedule <- schedule
rm(schedule)
}
print(paste("Done with", teams$Team[j]))
}
schedule <- tryCatch({ html %>%
html_element("tbody") %>%
html_table()  %>%
as.data.frame()
},  error=function(cond) {
})
if(!(is.null(schedule))){
colnames(schedule) <-  schedule[schedule[,1] == "DATE",][1,]
schedule <-  schedule[!schedule[,1] == "DATE",]
schedule <- schedule[,-ncol(schedule)]
schedule <- schedule %>%
as.data.frame() %>%
filter(grepl("Fri", DATE) |
grepl("Sat", DATE) |
grepl(",", DATE)) %>%
filter(RESULT != "Canceled") %>%
filter(grepl("[0-9]",RESULT)) %>%
mutate(OT = grepl("OT", RESULT),
OT_num = map_chr(ifelse(OT, str_extract_all(RESULT, ".(?=OT)"), NA), 1),
OT_num = ifelse(OT & OT_num == "", 1, OT_num)) %>%
mutate(RESULT = gsub(".(?=OT)", "", RESULT, perl = TRUE)) %>%
mutate(RESULT = ifelse(substr(RESULT,1,1) == "W" | substr(RESULT,1,1) == "L", RESULT, "NA-NA")) %>%
mutate(win_loss = substr(RESULT,1,1),
points_winner = map_chr(str_split(RESULT, "-"), 1),
points_winner = gsub("W", "", points_winner),
points_winner = gsub("L", "", points_winner),
points_loser = map_chr(str_split(RESULT, "-"),2),
points_loser = gsub("[^0-9]", "", points_loser),
points_loser = gsub("L", "", points_loser),
pass = gsub("[^0-9]", "", `HI PASS`),
rush = gsub("[^0-9]", "", `HI RUSH`),
rec = gsub("[^0-9]", "", `HI REC`),
points_allowed = ifelse(win_loss == "W", points_loser, points_winner),
points_scored = ifelse(win_loss == "W", points_winner, points_loser),
point_differential = as.numeric(points_scored) - as.numeric(points_allowed),
home_game = grepl("vs", OPPONENT),
OPPONENT = gsub("vs", "", OPPONENT),
OPPONENT = gsub("@", "", OPPONENT),
OPPONENT = gsub("\\*$", "", OPPONENT),
OPPONENT = gsub("[0-9]", "", OPPONENT),
OPPONENT = trimws(OPPONENT),
Team = trimws(teams$team_and_mascot[j]),
Team_id = teams$code[j]) %>%
select(date = "DATE",
Team,
Team_id,
opponent = "OPPONENT",
win_loss,
OT,
OT_num,
pass,
rush,
rec,
points_allowed,
points_scored,
point_differential,
home_game)
schedule <- padding_weeks(schedule,
year[i])
if(exists("all_schedule")){
all_schedule <- rbind(all_schedule,
schedule)
rm(schedule)
} else {
all_schedule <- schedule
rm(schedule)
}
print(paste("Done with", teams$Team[j]))
}
View(all_schedule)
library(rvest)
library(tidyverse)
library(rio)
source("Bye week function.R")
year <- c("2024",
"2023",
"2022",
"2021",
"2020")
teams <- import("2025 Teams.csv")
for(i in 1:length(year)){
html <- read_html(paste0("https://www.espn.com/college-football/fpi/_/view/resume/season/",
year[i]))
bin <- tryCatch({ html %>%
# html_element("tbody") %>%
html_table()
},  error=function(cond) {
})
bin <- do.call(cbind, bin)
colnames(bin) <- bin[1,]
rankings <- bin[-1,]
for(j in 1:nrow(teams)){
html <- read_html(paste0("https://www.espn.com/college-football/team/schedule/_/id/",
teams$code[j],
"/season/",
year[i]) )
schedule <- tryCatch({ html %>%
html_element("tbody") %>%
html_table()  %>%
as.data.frame()
},  error=function(cond) {
})
if(!(is.null(schedule))){
colnames(schedule) <-  schedule[schedule[,1] == "DATE",][1,]
schedule <-  schedule[!schedule[,1] == "DATE",]
schedule <- schedule[,-ncol(schedule)]
schedule <- schedule %>%
as.data.frame() %>%
filter(grepl("Fri", DATE) |
grepl("Sat", DATE) |
grepl(",", DATE)) %>%
filter(RESULT != "Canceled") %>%
filter(grepl("[0-9]",RESULT)) %>%
mutate(OT = grepl("OT", RESULT),
OT_num = map_chr(ifelse(OT, str_extract_all(RESULT, ".(?=OT)"), NA), 1),
OT_num = ifelse(OT & OT_num == "", 1, OT_num)) %>%
mutate(RESULT = gsub(".(?=OT)", "", RESULT, perl = TRUE)) %>%
mutate(RESULT = ifelse(substr(RESULT,1,1) == "W" | substr(RESULT,1,1) == "L", RESULT, "NA-NA")) %>%
mutate(win_loss = substr(RESULT,1,1),
points_winner = map_chr(str_split(RESULT, "-"), 1),
points_winner = gsub("W", "", points_winner),
points_winner = gsub("L", "", points_winner),
points_loser = map_chr(str_split(RESULT, "-"),2),
points_loser = gsub("[^0-9]", "", points_loser),
points_loser = gsub("L", "", points_loser),
pass = gsub("[^0-9]", "", `HI PASS`),
rush = gsub("[^0-9]", "", `HI RUSH`),
rec = gsub("[^0-9]", "", `HI REC`),
points_allowed = ifelse(win_loss == "W", points_loser, points_winner),
points_scored = ifelse(win_loss == "W", points_winner, points_loser),
point_differential = as.numeric(points_scored) - as.numeric(points_allowed),
home_game = grepl("vs", OPPONENT),
OPPONENT = gsub("vs", "", OPPONENT),
OPPONENT = gsub("@", "", OPPONENT),
OPPONENT = gsub("\\*$", "", OPPONENT),
OPPONENT = gsub("[0-9]", "", OPPONENT),
OPPONENT = trimws(OPPONENT),
Team = trimws(teams$team_and_mascot[j]),
Team_id = teams$code[j]) %>%
select(date = "DATE",
Team,
Team_id,
opponent = "OPPONENT",
win_loss,
OT,
OT_num,
pass,
rush,
rec,
points_allowed,
points_scored,
point_differential,
home_game)
schedule <- padding_weeks(schedule,
year[i])
if(exists("all_schedule")){
all_schedule <- rbind(all_schedule,
schedule)
rm(schedule)
} else {
all_schedule <- schedule
rm(schedule)
}
print(paste("Done with", teams$Team[j]))
}
}
all_schedule <- all_schedule %>%
mutate(season = year[i]) %>%
merge(bin) %>%
select(-`REM SOS`)
if(exists("all_schedule_all_year")){
all_schedule_all_year <- rbind(all_schedule_all_year,
all_schedule)
rm(all_schedule)
} else {
all_schedule_all_year <- all_schedule
rm(all_schedule)
}
print(paste0("Done with", year[i]))
}
write.csv(all_schedule_all_year, "CollegeFootballRankings24to20.csv", row.names = FALSE)
